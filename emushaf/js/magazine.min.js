function addPage(e,i){i.turn("pages");var t=$("<div />",{});i.turn("addPage",t,e)&&(t.html('<div class="gradient"></div><div class="loader"></div>'),loadPage(e,t))}function loadPage(e,i){var t=$("<img />");t.mousedown(function(e){e.preventDefault()}),t.load(function(){$(this).css({width:"100%",height:"100%"}),$(this).appendTo(i),i.find(".loader").remove()}),t.attr("src","pages/"+e+".webp"),loadRegions(e,i)}function zoomTo(e){setTimeout(function(){1==$(".magazine-viewport").zoom("value")?$(".magazine-viewport").zoom("zoomIn",e):$(".magazine-viewport").zoom("zoomOut")},1)}function loadRegions(e,i){$.getJSON("pages/"+e+"-regions.json").done(function(e){$.each(e,function(e,t){addRegion(t,i)})})}function addRegion(e,i){var t=$("<div />",{class:"region  "+e.class}),n=$(".magazine").turn("options"),a=n.width/2,o=n.height;t.css({top:Math.round(e.y/o*100)+"%",left:Math.round(e.x/a*100)+"%",width:Math.round(e.width/a*100)+"%",height:Math.round(e.height/o*100)+"%"}).attr("region-data",$.param(e.data||"")),t.appendTo(i)}function regionClick(e){var i=$(e.target);if(i.hasClass("region")){$(".magazine-viewport").data().regionClicked=!0,setTimeout(function(){$(".magazine-viewport").data().regionClicked=!1},100);var t=$.trim(i.attr("class").replace("region",""));return processRegion(i,t)}}function processRegion(e,i){switch(data=decodeParams(e.attr("region-data")),i){case"link":window.open(data.url);break;case"zoom":var t=e.offset(),n=$(".magazine-viewport").offset(),a={x:t.left-n.left,y:t.top-n.top};$(".magazine-viewport").zoom("zoomIn",a);break;case"to-page":$(".magazine").turn("page",data.page)}}function loadLargePage(e,i){var t=$("<img />");t.load(function(){var e=i.find("img");$(this).css({width:"100%",height:"100%"}),$(this).appendTo(i),e.remove()}),t.attr("src","pages/"+e+".webp")}function loadSmallPage(e,i){var t=i.find("img");t.css({width:"100%",height:"100%"}),t.unbind("load"),t.attr("src","pages/"+e+".webp")}function isChrome(){return-1!=navigator.userAgent.indexOf("Chrome")}function disableControls(e){1==e?($(".previous-button").hide(),$(".prev").hide(),$(".first").hide()):($(".previous-button").show(),$(".prev").show(),$(".first").show()),e>=604?($(".next").hide(),$(".last").hide()):($(".next").show(),$(".last").show()),e==$(".magazine").turn("pages")?$(".next-button").hide():$(".next-button").show()}function resizeViewport(){var e=$(window).width(),i=$(window).height(),t=$(".magazine").turn("options");if($(".magazine").removeClass("animated"),$(".magazine-viewport").css({width:e,height:i}).zoom("resize"),1==$(".magazine").turn("zoom")){var n=calculateBound({width:t.width,height:t.height,boundWidth:Math.min(t.width,e),boundHeight:Math.min(t.height,i)});n.width%2!=0&&(n.width-=1),n.width==$(".magazine").width()&&n.height==$(".magazine").height()||($(".magazine").turn("size",n.width,n.height),1==$(".magazine").turn("page")&&$(".magazine").turn("peel","br"),$(".next-button").css({height:n.height,backgroundPosition:"-38px "+(n.height/2-16)+"px"}),$(".previous-button").css({height:n.height,backgroundPosition:"-4px "+(n.height/2-16)+"px"})),$(".magazine").css({top:-n.height/2,left:-n.width/2})}var a=$(".magazine").offset(),o=i-a.top-$(".magazine").height(),h=(o-$(".thumbnails > div").height())/2;h<0?$(".thumbnails").css({height:1}):($(".thumbnails").css({height:o}),$(".thumbnails > div").css({marginTop:h})),a.top<$(".made").height()?$(".made").hide():$(".made").show(),$(".magazine").addClass("animated")}function numberOfViews(e){return e.turn("pages")/2+1}function getViewNumber(e,i){return parseInt((i||e.turn("page"))/2+1,10)}function moveBar(e){Modernizr&&Modernizr.csstransforms&&$("#slider .ui-slider-handle").css({zIndex:e?-1:1e4})}function setPreview(e){var i=112,t=73,n="pages/preview.webp",a=$(_thumbPreview.children(":first")),o=1==e||e==$("#slider").slider("option","max")?1:2,h=1==o?i/2:i;_thumbPreview.addClass("no-transition").css({width:h+15,height:t+15,top:-t-30,left:($($("#slider").children(":first")).width()-h-15)/2}),a.css({width:h,height:t}),""!==a.css("background-image")&&"none"!=a.css("background-image")||(a.css({backgroundImage:"url("+n+")"}),setTimeout(function(){_thumbPreview.removeClass("no-transition")},0)),a.css({backgroundPosition:"0px -"+(e-1)*t+"px"})}function largeMagazineWidth(){var e=window.innerWidth>0?window.innerWidth:screen.width;return console.log(e),e}function decodeParams(e){for(var i,t=e.split("&"),n={},a=0;a<t.length;a++)i=t[a].split("="),n[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);return n}function calculateBound(e){var i={width:e.width,height:e.height};if(i.width>e.boundWidth||i.height>e.boundHeight){var t=i.width/i.height;e.boundWidth/t>e.boundHeight&&e.boundHeight*t<=e.boundWidth?(i.width=Math.round(e.boundHeight*t),i.height=e.boundHeight):(i.width=e.boundWidth,i.height=Math.round(e.boundWidth/t))}return i}